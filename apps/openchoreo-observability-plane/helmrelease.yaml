---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: openchoreo-observability-plane
  namespace: openchoreo-observability-plane
spec:
  interval: 30m
  dependsOn:
    - name: openchoreo-control-plane
      namespace: openchoreo-control-plane
  chart:
    spec:
      chart: openchoreo-observability-plane
      version: "0.12.0"
      sourceRef:
        kind: HelmRepository
        name: openchoreo
        namespace: flux-system
      interval: 12h
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    global:
      # Single-cluster non-HA mode uses standalone OpenSearch instead of operator
      installationMode: singleCluster
    # Use standalone OpenSearch (not operator-managed cluster)
    openSearch:
      enabled: true
      service:
        type: LoadBalancer
    # Disable OpenSearch operator cluster (using standalone instead)
    openSearchCluster:
      enabled: false
    # Observer API - REST API for querying logs and metrics
    observer:
      service:
        type: LoadBalancer
    # OpenSearch Dashboards - UI for visualizing logs and data
    openSearchDashboards:
      service:
        type: LoadBalancer
    # Disable External Secrets since it's already in the Data Plane (single cluster)
    external-secrets:
      enabled: false
    fakeSecretStore:
      enabled: false
    security:
      oidc:
        jwksUrl: "http://thunder-service.openchoreo-control-plane.svc.cluster.local:8090/oauth2/jwks"
        tokenUrl: "http://thunder-service.openchoreo-control-plane.svc.cluster.local:8090/oauth2/token"
